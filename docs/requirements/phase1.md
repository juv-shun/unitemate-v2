# フェーズ1要件定義（改定版）

## 1. 目的
マッチ成立後のロビー共有までを、シンプルな運用と低いネットワークコストで実現する。

## 2. 基本フロー
1. マッチ成立（10人）
2. ステータスを `lobby_pending` にする
3. 各ユーザーに「ロビーへ進む」ボタンを表示
4. チーム分け済みのメンバー一覧を表示
5. ロビーIDを入力・共有（早い者勝ちで上書き可）
6. **ロビーIDが入力済み** かつ **全員着席** になっても `lobby_pending` のまま維持する

## 3. ロビーID
- 8桁の数字固定（先頭0を許可）
- 早い者勝ち（誰でも上書き可能）
- 入力者に限定せず上書き可能

## 4. 着席
- マッチング直後にロビーへ進むモーダルを表示して、押下することで、着席した状態でロビー画面に遷移できる。
- 着席/未着席の状態はメンバー一覧に反映される

## 5. ロビーに入れない（困り中）
- 各ユーザーが「ロビーに入れない」ボタンを押せる
- 押下したユーザーの席に「ロビーに入れない」と表示される
- 押下後は解除ボタンで解除できる

## 6. 通報
- 各チームのユーザーの横に「通報」ボタンを表示
- 通報時は以下を記録する
  - マッチ成立日時
  - 通報日時
  - 通報理由

## 7. ステータス遷移
- マッチ成立時: `lobby_pending`
- ロビーID入力済み かつ 全員着席: `lobby_pending` のまま

## 8. 非要件（フェーズ1では対応しない）
- ドラフト開始/進行の自動遷移
- ロビーID入力のタイムアウトや自動再抽選

## 9. ナビゲーション・離脱制御

### 9.1 マッチング待機中の挙動
- **アプリ内回遊**:
  - 待機中（Finding Match）であっても、トップページ以外のページ（マイページ、ランキング等）へ自由に遷移可能。
  - ページを移動しても待機状態は維持される。
- **外部離脱時の警告とキャンセル**:
  - ブラウザのタブを閉じる、リロード、外部サイトへ移動するなど、アプリから離脱しようとした場合はブラウザ標準の警告ダイアログ（`beforeunload`）を表示する。
  - ユーザーが警告を無視して離脱した場合は、バックグラウンド処理により可能な限りインキュー状態のキャンセルを試みる。

### 9.2 マッチング成立後の挙動
- **強制遷移**:
  - マッチング成立の瞬間（`waiting` -> `matched`）に、強制的にロビー画面へ遷移させる。
- **マッチ中の回遊**:
  - ロビー画面到達後は、アプリ内の他ページ（マイページ等）へ自由に遷移可能。
  - ただし、トップページ（`/`）へアクセスした場合は、ロビー画面へリダイレクト（強制送還）される。
