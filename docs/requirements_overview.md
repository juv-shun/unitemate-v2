# ユナメイト 要件定義書（フェーズ別ロードマップ版）

## 0. 本書の目的

本書は、ユナメイトを段階的に開発するために、要件をフェーズ1からフェーズ6に分けて整理する。
フェーズ1は“マッチングと試合成立”を最優先し、勝敗報告、レーティング、ドラフト機能へと機能拡張を進めるロードマップとする。

---

## 1. プロダクト概要

### 1.1 ユナメイトとは

ポケモンユナイトのドラフトピック形式のマッチを、アプリでマッチング・ドラフト進行し、試合自体はゲーム内（アプリ外）で行うシステム。

### 1.2 スコープ（共通）

* 対象：10人（5vs5）
* アプリ内：キュー、マッチング、ドラフト（BAN/PICK）、ロビーID共有、勝敗報告、レーティング
* アプリ外：ゲーム内ロビー作成・参加・試合実施

---

## 2. フェーズ定義

### フェーズ1: マッチング・ロビーID共有（ドラフトなし）
* **ドラフトピックなし**
* **レーティングシステムなし**
* マッチングを行い、ホスト（ロビー作成者）を決定し、各メンバーにロビーIDを伝える体験までを実現することをゴールとする。

### フェーズ2: 勝敗報告・判定システム
* 試合後（ロビーID共有完了後）、試合結果を入力するフォームを追加
* 入力された試合結果から、システムが多数決式で勝敗判定を行う機能を追加

### フェーズ3: レーティングシステム
* **マッチングアルゴリズムの高度化**: レート順抽出により近い実力のマッチングを作る
* **レート更新**: 試合結果確定時にレーティング変動を行う（対面比較方式）
* **UI表示**: レート表示を行う（詳細は検討中）

### フェーズ4: ドラフトピックシミュレーター
* ドラフトピック機能単体の開発を行う
* マッチング機能とは別の独立した画面・URLから、ドラフト進行だけをシミュレーションできる機能を実装する
* ※この時点では、マッチング機能にはドラフト機能を組み込まない

### フェーズ5: マッチング連携ドラフト
* マッチング機能からフェーズ4のドラフトシミュレーター（またはそのロジック）を呼び出し、マッチング後にドラフトピックを行うフローを完成させる

### フェーズ6: 管理機能・その他
* 管理者機能など、アプリの本質機能以外の追加

---

## 3. フェーズ1要件: マッチングとロビー共有

### 3.1 基本フロー（フェーズ1）
1. ユーザー登録/ログイン
2. インキュー
3. 10人でマッチ成立（キューイング条件による実行）
4. チーム分け（ランダム）・先攻後攻決定
5. ロビーID共有フローを実施
6. 全員がロビーIDを見てゲーム内で参加し試合開始

### 3.2 マッチング実行条件
以下いずれかでマッチングを実行する。

* キュー人数が30人以上になった
* 先頭のキュー参加から3分が経過した

マッチング実行時は、できるだけ多くの試合を一度に生成する（例：30人なら3試合）。

### 3.3 ロビーID共有要件
詳細は `docs/requirements_phase1.md` を参照。

---

## 4. フェーズ2要件: 勝敗報告システム

### 4.1 試合結果入力
* 対象: マッチング成立し、ロビーID共有フローを経た参加者
* タイミング: 試合終了後（またはロビー共有後の一定時間後）
* 入力内容: 勝ち / 負け / 無効（ノーコンテスト）

### 4.2 勝敗判定ロジック
* 参加者からの報告定数を基に、システムが自動で勝敗を確定させる（多数決方式想定）
* 確定した勝敗データはDBに蓄積する

---

## 5. フェーズ3要件: レーティングシステム

詳細なマッチングロジック、レート計算仕様については、別紙を参照のこと。

* 参照先: `docs/requirements_phase3.md`

---

## 6. フェーズ4要件: ドラフトピックシミュレーター

* マッチング機能に依存せず、ドラフトのUI/UXとロジックを検証するための独立モジュールとして開発する
* `docs/requirements_phase4.md` を参照。

---

## 7. フェーズ5要件: マッチング連携ドラフト

フェーズ1のフローにドラフト工程を挿入する。

1. マッチ成立（レートベースマッチング：フェーズ3機能）
2. **ドラフトフェーズ**（フェーズ4の機能）
   * BAN/PICKリザルトが表示される
3. ホスト抽選・ロビーID共有（フェーズ1機能）
4. 試合開始
5. 勝敗報告・レート更新（フェーズ2/3機能）

---

## 8. フェーズ別実装マップ

| 機能 | Phase 1 | Phase 2 | Phase 3 | Phase 4 | Phase 5 |
| :--- | :---: | :---: | :---: | :---: | :---: |
| **マッチング** | ✅ (ランダム) | ✅ | ✅ (レート順) | - | ✅ |
| **ロビーID共有** | ✅ | ✅ | ✅ | - | ✅ |
| **勝敗報告** | - | ✅ | ✅ | - | ✅ |
| **レーティング** | - | - | ✅ | - | ✅ |
| **ドラフト機能** | - | - | - | ✅ (Simulator) | ✅ (Integrated) |
